/*  ConfigurableMapViewerCMV
 *  version 1.3.4
 *  Project: http://cmv.io/
 */

define(["dojo/_base/array","dojo/_base/lang","dojo/has","dojo/topic","dojo/dom-construct","dojo/dom-class","dojo/dom-style","dojo/html","dijit/registry","dojox/gfx","esri/request","esri/dijit/Legend","dojo/i18n!esri/nls/jsapi","dojo/i18n!./../nls/resource"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";return m.widgets.legend.NLS_noLegend=n.noLegend,{isLegend:function(a,b){return null===b||b===!1?a===!0?!1:!0:b===!0?a===!1?!0:!1:void 0},_legendRequest:function(a,c,d,e){k({url:a.url+"/legend",callbackParamName:"callback",content:{f:"json",token:"function"==typeof a._getToken?a._getToken():null}}).then(b.hitch(this,d,a,c),b.hitch(this,e,a,c))},_arcgisLegendRequest:function(a,d,e,f){var g=a.url.toLowerCase().indexOf("/rest/"),h=a.url.substring(0,g)+a.url.substring(g+5,a.url.length),i="http://utility.arcgis.com/sharing/tools/legend?soapUrl="+window.escape(h);(!c("ie")||c("ie")>8)&&(i+="&returnbytes=true"),k({url:i,callbackParamName:"callback",content:{f:"json"}}).then(b.hitch(this,e,a,d),b.hitch(this,f,a,d))},_image:function(a,b,d){var f=a.url;if((!c("ie")||c("ie")>=9)&&a.imageData&&a.imageData.length>0)f="data:image/png;base64,"+a.imageData;else if(0!==a.url.indexOf("http")){f=d.url+"/"+b+"/images/"+a.url;var h=d._getToken();h&&(f+="?token="+h)}var i=e.create("img",{src:f,"class":d.id+"-layerLegendImage"});return g.set(i,{width:a.width+"px",height:a.height+"px",opacity:d.opacity}),i},layerLegend:function(a,b){var c=new l({map:a.getMap(),layerInfos:[{layer:a}]},e.create("div",{},b));setTimeout(function(){c.startup()},1)},dynamicSublayerLegend:function(a,b){a.version>=10.01?this._legendRequest(a,b,"_createDynamicSublayerLegend","_dynamicSublayerLegendError"):this._arcgisLegendRequest(a,b,"_createDynamicSublayerLegend","_dynamicSublayerLegendError")},_createDynamicSublayerLegend:function(b,c,d){a.forEach(d.layers,function(d){var g=d.layerId,j=e.create("table");if(f.add(j,"layerControlLegendTable"),a.forEach(d.legend,function(a){var c=e.create("tr",{},j,"last"),d=e.create("td",{"class":"layerControlLegendImage"},c,"first");e.create("td",{innerHTML:a.label||"&nbsp;","class":"layerControlLegendLabel"},c,"last"),e.place(this._image(a,g,b),d)},this),b.layerInfos.length>1){var k=i.byId(b.id+"-"+d.layerId+"-sublayer-control").expandNode;h.set(k,""),e.place(j,k)}else e.place(j,c)},this)},_dynamicSublayerLegendError:function(a,b,c){1===a.layerInfos.length&&h.set(b,"No Legend"),d.publish("viewer/handleError",{source:"LayerControl/legendUtil/_createDynamicSublayerLegend",error:c})},_surfaceDims:[20,20],vectorLegend:function(a,b){var c=a.renderer.symbol,d=a.renderer.infos;c?this._createVectorLegend([{symbol:c,description:"",label:"",value:""}],a,b):d?this._createVectorLegend(d,a,b):h.set(b,"No Legend")},_createVectorLegend:function(b,c,i){var k=e.create("table");f.add(k,"layerControlLegendTable"),a.forEach(b,function(a){var b=e.create("tr",{},k,"last"),l=e.create("td",{"class":"layerControlLegendImage"},b,"first");e.create("td",{innerHTML:a.label||"&nbsp;","class":"layerControlLegendLabel"},b,"last");var m=a.symbol,n=m.getShapeDescriptors(),o=n.defaultShape,p=n.fill,q=n.stroke;if(o.src){var r=e.create("img",{src:o.src},l);g.set(r,{width:m.width+"px",height:m.height+"px",opacity:c.opacity}),f.add(r,c.id+"-layerLegendImage")}else if(m){var s=this._surfaceDims[0],t=this._surfaceDims[1];m.width&&m.height&&(s=m.width,t=m.height);var u=e.create("span",{},l);g.set(u,{width:s+"px",height:t+"px",display:"inline-block"});var v=j.createSurface(u,s,t),w=v.createShape(o);p&&w.setFill(p),q&&w.setStroke(q),w.applyTransform({dx:s/2,dy:t/2}),g.set(l,{opacity:c.opacity}),f.add(l,c.id+"-layerLegendImage")}else h.set(i,"No Legend"),d.publish("viewer/handleError",{source:"LayerControl/legendUtil/_createVectorLegend",error:"renderer does not contain symbol(s)"});e.place(k,i)},this)}}});
//# sourceMappingURL=legendUtil.map